<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Virtual Assessment 360°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Pannellum -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.css"/>

  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    header {
      background: linear-gradient(to right, #0077b6, #00b4d8);
      color: white;
      text-align: center;
      padding: 10px;
      font-size: 18px;
      font-weight: bold;
    }

    #container {
      display: flex;
      height: calc(100% - 50px);
    }

    #panorama, #map {
      flex: 1;
      height: 100%;
    }

    /* Tombol Daftar Isi */
    #daftarIsiBtn {
      position: absolute;
      top: 65px;   /* default (HP) */
      right: 10px;
      z-index: 1000;
      background: white;
      border: 1px solid #ccc;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    /* Geser tombol saat dibuka di laptop/desktop */
    @media (min-width: 1024px) {
      #daftarIsiBtn {
        top: 110px;
      }
    }

    /* Panel daftar isi */
    #daftarIsiPanel {
      position: absolute;
      top: 110px;
      right: 10px;
      z-index: 999;
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      display: none;
      max-width: 250px;
    }

    #daftarIsiPanel h4 {
      margin: 5px 0;
    }

    #daftarIsiPanel ul {
      padding-left: 15px;
    }

    #daftarIsiPanel ul li {
      margin: 4px 0;
    }

    #daftarIsiPanel ul li a {
      text-decoration: none;
      color: #0077b6;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    Virtual Assessment 360° Untuk Proses Pengadaan Tanah - Zona Rokan
  </header>

  <div id="container">
    <div id="panorama"></div>
    <div id="map"></div>
  </div>

  <!-- Tombol & Panel Daftar Isi -->
  <button id="daftarIsiBtn">Daftar Isi</button>
  <div id="daftarIsiPanel">
    <h4>Layer</h4>
    <label><input type="checkbox" id="toggleBatas"> Batas Kecamatan</label>

    <h4>Lokasi</h4>
    <ul>
      <li><a href="#" onclick="zoomTo('A')">A : Pipa Air Well 5C-58</a></li>
      <li><a href="#" onclick="zoomTo('B')">B : BEKA25_0007</a></li>
      <li><a href="#" onclick="zoomTo('C')">C : BEKA_#71</a></li>
      <li><a href="#" onclick="zoomTo('D')">D : P_MINA25_0017HW</a></li>
      <li><a href="#" onclick="zoomTo('E')">E : 9D-28E</a></li>
      <li><a href="#" onclick="zoomTo('F')">F : KB 500</a></li>
    </ul>
  </div>

  <script>
    // === Pannellum ===
    var viewer = pannellum.viewer('panorama', {
      type: "equirectangular",
      panorama: "foto360/a.jpg",  // ganti dengan foto default
      autoLoad: true
    });

    // === Leaflet ===
    var map = L.map('map').setView([0.72, 101.45], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Data lokasi
    var locations = {
      "A": { coords: [0.703194, 101.465667], foto: "foto360/a.jpg", name: "Pipa Air Well 5C-58" },
      "B": { coords: [0.6665, 101.4468], foto: "foto360/b.jpg", name: "BEKA25_0007" },
      "C": { coords: [0.6712, 101.4779], foto: "foto360/c.jpg", name: "BEKA_#71" },
      "D": { coords: [0.7710, 101.4007], foto: "foto360/d.jpg", name: "P_MINA25_0017HW" },
      "E": { coords: [0.7032, 101.4857], foto: "foto360/e.jpg", name: "9D-28E" },
      "F": { coords: [0.6845, 101.1115], foto: "foto360/f.jpg", name: "KB 500" }
    };

    window.markers = {};
    for (let id in locations) {
      let loc = locations[id];
      let marker = L.marker(loc.coords).addTo(map).bindPopup(id + " : " + loc.name);
      marker.on('click', function () {
        viewer.loadScene(id, { panorama: loc.foto });
      });
      window.markers[id] = marker;
    }

    // Fungsi zoom dari daftar isi
    function zoomTo(id) {
      if (window.markers[id]) {
        map.setView(window.markers[id].getLatLng(), 16);
        window.markers[id].openPopup();
        viewer.loadScene(id, { panorama: locations[id].foto });
      }
    }

    // === Toggle daftar isi ===
    document.getElementById('daftarIsiBtn').addEventListener('click', function () {
      var panel = document.getElementById('daftarIsiPanel');
      panel.style.display = (panel.style.display === 'none' || panel.style.display === '') ? 'block' : 'none';
    });

    // === Layer batas kecamatan (contoh geojson sederhana) ===
    var batasKecamatan = L.geoJSON(null, {
      style: { color: "red", weight: 2 }
    });

    document.getElementById('toggleBatas').addEventListener('change', function (e) {
      if (e.target.checked) {
        batasKecamatan.addTo(map);
      } else {
        map.removeLayer(batasKecamatan);
      }
    });
  </script>
</body>
</html>
